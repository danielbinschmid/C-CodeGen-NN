# C-CodeGen-NN

This repository contains a toolchain to generate code for neural networks described by the ONNX format to *dependency free* C code using ApacheTVM. <br>
The target is to generate C code that can be used for circuit simulation frameworks such as Chipyard or Synopsis.

## Features

- FrontEnds: ONNX
- Build tools: standard _gcc_, _riscv64-unknown-elf_, _riscv64-unknown-elf baremetal_

## Setup

- Tested with python version 3.9.15
- Dependency management via poetry

After activating fresh virtual python environment:
```s
$ pip install --upgrade pip
$ pip install poetry
$ poetry install
```

## Usage

1. Prepare onnx file. Modify [prepare.sh](./prepare.sh) to your needs. Generate dummy verification data:
```s
$ ./prepare.sh
```
2. Generate C code. Modify [generate.sh](./generate.sh) to your needs. Generate C code:
```s
$ ./generate.sh
```
3. Build. Build with e.g.
```s
$ cd <c_code_dir>
$ make
```
4. Run. C code logs computed output and reference output to the console. They match if the generated C code generated by TVM is correct. If they do not match, the issue either lies in the verification data or at Apache TVM. Execute e.g. via:
```s
$ cd <build_dir>
$ ./executable
```

### Note
Most of the steps work with multiple input and output arguments of the neural network but not all. For multiple inputs and outputs, the scripts need to be adjusted.
